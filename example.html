<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>wasm-crypto Example</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { background: #f0f0f0; padding: 10px; margin: 10px 0; }
        .error { background: #ffeeee; border: 1px solid #cc0000; }
        .success { background: #eeffee; border: 1px solid #00cc00; }
    </style>
</head>
<body>
    <h1>wasm-crypto Example</h1>
    <p>This example demonstrates the wasm-crypto library functionality.</p>
    
    <button onclick="testSha3()">Test SHA-3</button>
    <button onclick="testMlDsa()">Test ML-DSA</button>
    <button onclick="testMlKem()">Test ML-KEM</button>
    
    <div id="results"></div>
    
    <script type="module">
        import init, { sha3Hash512, MlDsa, MlKem } from './pkg/wasm_crypto.js';
        
        // Initialize the WebAssembly module
        await init();
        
        window.testSha3 = function() {
            try {
                const data = new TextEncoder().encode("Hello, World!");
                const hash = sha3Hash512(data);
                showResult('SHA-3 Hash', Array.from(hash).map(b => b.toString(16).padStart(2, '0')).join(''), 'success');
            } catch (error) {
                showResult('SHA-3 Error', error.message, 'error');
            }
        };
        
        window.testMlDsa = function() {
            try {
                const mlDsa = new MlDsa();
                const message = new TextEncoder().encode("Test message");
                const signature = MlDsa.sign(mlDsa.signingKey, message);
                const isValid = MlDsa.verify(message, signature, mlDsa.verifyingKey);
                
                showResult('ML-DSA Signature', `Valid: ${isValid}, Signature length: ${signature.length} bytes`, 'success');
            } catch (error) {
                showResult('ML-DSA Error', error.message, 'error');
            }
        };
        
        window.testMlKem = function() {
            try {
                const mlKem = new MlKem();
                const encapsulation = MlKem.encapsulate(mlKem.encapsulationKey);
                const sharedSecret = MlKem.decapsulate(mlKem.decapsulationKey, encapsulation.ciphertext);
                
                const match = arraysEqual(encapsulation.sharedSecret, sharedSecret);
                showResult('ML-KEM Key Exchange', 
                    `Shared secrets match: ${match}, Secret length: ${sharedSecret.length} bytes`, 'success');
            } catch (error) {
                showResult('ML-KEM Error', error.message, 'error');
            }
        };
        
        function showResult(title, message, type) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<strong>${title}:</strong> ${message}`;
            results.appendChild(div);
        }
        
        function arraysEqual(a, b) {
            return a.length === b.length && a.every((val, i) => val === b[i]);
        }
    </script>
</body>
</html>